<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test/api/imgur</title>

    <link rel="stylesheet" href="../../node_modules/mocha/mocha.css">

    <script src="../../node_modules/mocha/mocha.js"></script>
    <script src="../../node_modules/chai/chai.js"></script>

    <script>
		window.NTT = { OptionsUI: {} };
    </script>
    <script src="../../dist/options_ui/js/imgur.js"></script>
</head>
<body>
<div id="mocha"></div>
<script>
	const assert = chai.assert;
    const Imgur = NTT.OptionsUI.Imgur;

	mocha.setup('bdd');

	describe('URL validity check', function()
	{
		it('should accept URLs across both http and https', function()
		{
            [
                "http://imgur.com/a/my_album",
                "https://imgur.com/a/my_album"
            ]
                .forEach(url => assert(Imgur.is_valid_album_url(url)));
			[
				"httpp://imgur.com/a/my_album",
				"http//imgur.com/a/my_album",
				"http:/imgur.com/a/my_album",
				"httpimgur.com/a/my_album",
			]
				.forEach(url => assert(!Imgur.is_valid_album_url(url)));
		});
		it('should accept URLs without protocol', function()
        {
        	assert(Imgur.is_valid_album_url("imgur.com/a/my_album"));
        });
		it('should accept URLs with and without www. prefix', function()
        {
			[
				"www.imgur.com/a/my_album",
				"imgur.com/a/my_album",
			]
				.forEach(url => assert(Imgur.is_valid_album_url(url)));
			[
				"wwww.imgur.com/a/my_album",
				"ww.imgur.com/a/my_album",
				"wwwimgur.com/a/my_album",
			]
				.forEach(url => assert(!Imgur.is_valid_album_url(url)));
        });
		it('should only accept URLs from the imgur domain', function()
        {
			[
				"google.com/a/my_album",
				"yahoo.com/a/my_album",
			]
				.forEach(url => assert(!Imgur.is_valid_album_url(url)));
        });
		it('should only accept URLs for albums', function()
        {
			[
				"imgur.com/b/my_album",
				"imgur.com/c/my_album",
			]
				.forEach(url => assert(!Imgur.is_valid_album_url(url)));
        });
	});
    describe('album hash extraction from URL', function()
    {
    	it('should extract hash across protocols and with or without www. prefix', function()
        {
			[
				"http://www.imgur.com/a/my_album",
				"http://imgur.com/a/my_album",
				"https://www.imgur.com/a/my_album",
				"https://imgur.com/a/my_album",
				"www.imgur.com/a/my_album",
				"imgur.com/a/my_album"
			]
				.forEach(url =>
            {
                assert.strictEqual("my_album", Imgur.extract_album_hash(url));
            });
        });
    });

	mocha.run();
</script>
</body>
</html>
